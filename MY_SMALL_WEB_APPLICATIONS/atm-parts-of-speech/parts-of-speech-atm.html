<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> parts of speech atm </title>
    <link rel="stylesheet" type="text/css" href="css/atm-css-by-soumen.css">
</head>
<body>
    <div id="atmName">PARTS OF SPEECH ATM</div>
    <div id="atmScreen"><span id="atmdisplay"></span></div>
    <div id="atmcard" onclick="cardanimseq()"><span id="atmText">Soumen's ATM Card</span></div>
    <div id="box"></div>
    <div id="LBBOX">
    <input type="button" id="Noun"><br><br><br> <!--class=LB-->
    <input type="button" id="Pronoun"><br><br><br>
    <input type="button" id="Verb"><br><br><br>
    <input type="button" id="Adverb"><br><br><br>
    </div>
    <div id="RBBOX">
    <input type="button" id="Adjective"><br><br><br><!--class=RB-->
    <input type="button" id="Preposition"><br><br><br>
    <input type="button" id="Conjunction"><br><br><br>
    <input type="button" id="Interjection"><br><br><br>
    </div>
    
    <div id="kbBox">
        <input type="button" value="1" class="kb" onclick="pinInput(this)">
        <input type="button" value="2" class="kb" onclick="pinInput(this)">
        <input type="button" value="3" class="kb" onclick="pinInput(this)"><br>
        <input type="button" value="4" class="kb" onclick="pinInput(this)">
        <input type="button" value="5" class="kb" onclick="pinInput(this)">
        <input type="button" value="6" class="kb" onclick="pinInput(this)"><br>
        <input type="button" value="7" class="kb" onclick="pinInput(this)">
        <input type="button" value="8" class="kb" onclick="pinInput(this)">
        <input type="button" value="9" class="kb" onclick="pinInput(this)"><br>
        <input type="button" value="X" class="kb" onclick="pinInput(this)" style="color: red;">
        <input type="button" value="0" class="kb" onclick="pinInput(this)">
        <input type="button" value="⏎" class="kb" onclick="pinInput(this)" style="color: green; ">
    </div>
    <div id="atmCardSlotBox"></div>
    <div id="cardSlot"></div>
    <div id="blinker"></div>
    <div id="soumen"><span>Created by<br>Soumen Chakraborty<br>2018</span></div>
    <div><span id="gpin"></span></div>
         
    <script>
        "use strict";
        var displaydelay=1000;
        var pinverified=false;// execution lock
        blinkerAnim();// use a gif here later
        const kbbtns=[Noun,Pronoun,Verb,Adverb,Adjective,Preposition,Conjunction,Interjection];
        var k=kbbtns.length; while(k--){kbbtns[k].setAttribute("onclick", "show("+k+")");
            kbbtns[k].value=kbbtns[k].id;if(k>3){kbbtns[k].setAttribute("class","RB");}else{kbbtns[k].setAttribute("class","LB");}}
        const beep=new Audio("audio/peenk.oga"); rotate("atmText",-90);
        var generatedpin = generatePin(9999);
        gpin.innerHTML=``; var pin=""; var pinlen= pin.length; var pinmask="";
        var card = e("atmcard"); var breaks=`<br><br><br>`;
        var atm={// atm object
            initialmsg: breaks+"Please <br><br>insert <br><br>the ATM Card.",
            pinpromptmsg: breaks+"Please enter the PIN.",
            pinverifiedmsg:breaks+"Pin verified."+breaks+"You may continue." ,
            pinmismatchmsg:breaks+"Incorrect Pin."+breaks+"Try again." ,
            resetPin: function(){pinmask=""; pin=""; pinlen=0;}
        }       
        display(atm.initialmsg);
        function pinInput(p){if(pinverified)return;beep.play(); pin+=`${p.value}`; 
                 pinmask+=`<span style="color:red;font-size:44px">*</span>`;
                 display(atm.pinpromptmsg+breaks+pinmask);
                if(pin.length===4 && pin===generatedpin){display(atm.pinverifiedmsg);
                        pinverified=true; atm.resetPin(); gpin.innerHTML="";
                }else if(pin.length===4 && pin!=generatedpin && pinverified==false){
                        display(atm.pinmismatchmsg); atm.resetPin();}}     
        
        function show(p){if(pinverified==false)return; // main trigger of sequence of parts of speech 
            if(0===p){nounactivity();} else if(1===p){pronounactivity();}
            else if(2===p){verbactivity();}else if(3===p){adverbactivity();}
            else if(4===p){adjectiveactivity();}else if(5===p){prepositionactivity();}
            else if(6===p){conjunctionactivity();} else if(7===p){interjectionactivity();}}      
           
        
        function cardanimseq(){if(pinverified)return;
            var aseq=[()=>{display("");cardAnim(0);},()=>{cardAnim(1);},()=>{cardAnim(2); }];
            var s=aseq.length; 
            //var speed=1500;// origianl speed
            var speed=1000;//debug speed
            var myTime = setInterval(myTimer, speed);
            function myTimer(){if(s==0){clearInterval(myTime);}s--;cardAnim(s);}}
        
        var b=false;
        function blinkerAnim(){var time=setInterval(blinks,800);
            function blinks(){if(b=b^1){blinker.style.backgroundColor="#00ff00";}
               else{blinker.style.backgroundColor="black";}}}           
        function e(id){return document.getElementById(id);}
        function rotate(id, degree){e(id).style = 'transform: rotate(' + degree + 'deg)'; 
}
        function generatePin(num){var gpin = (Math.floor(Math.random()*num)).toString();
            while(gpin<=1000){gpin=  (Math.floor(Math.random()*9999)).toString();}return gpin;}
        function cardAnim(p){
           // slideSound.play();
            var inipos=500; var endpos=310; var speed=10;
            if(0==p){var myTime = setInterval(myTimer, speed); var m=endpos;
                function myTimer(){if(m>=inipos){clearInterval(myTime);} 
                    m+=2; card.style.top=m+"px";} card.style.pointerEvents="none";}
            else if(1==p){display("");
                var time = setTimeout(myTime,1500);gpin.innerHTML=`Use ${generatedpin} as PIN.`;
                function myTime(){display(atm.pinpromptmsg);} 
            }else if(2==p){var myTime = setInterval(myTimer, speed); var m=inipos; 
                function myTimer(){if(m<=endpos){clearInterval(myTime);} 
                    m-=1; card.style.top=m+"px";}}}
        function display(m){atmdisplay.innerHTML=m;} 
        
        function shuffle(array){            
            var count = array.length, randomnumber;
            while( count > 1 ){
                randomnumber = Math.floor ( Math.random() * count-- ); 
                if(randomnumber != count){
                    swap(array,count,randomnumber);
                }
            }
        }function swap(array, a, b){
           var temp=array[a];
           array[a]=array[b];
           array[b]=temp;
        }
        
    var newvalue; var oldvalue; 
    function nounactivity(){//ch
        const nouns=[`Soumen <br><br><br>Soumen is a teacher.`
                     ,"cat<br><br><br>The cat purrs."
                     ,"horse<br><br><br>The horse runs fast."
                     ,"dog<br><br><br>A barking dog seldom bites."
        ];
        shuffle(nouns); var len = nouns.length;//ch
        display(breaks+`You requested a Noun.<br><br>Transaction in progress.<br><br>Please wait....`);//ch
        var repeat = setInterval(dothis,displaydelay); var i=0;
        var all=[
             ()=>{display(``);}
            ,()=>{dontRepeatNoun();}//ch
            ,()=>{display(``);}
        ];  var howmanytimes = all.length;
        function dothis(){if( i>=howmanytimes){ clearInterval(repeat);i=0; return;} all[i](); i++;}
        function dontRepeatNoun(){
            do {newvalue=Math.floor(Math.random()*len);}while(newvalue===oldvalue);
            display(breaks+nouns[newvalue]); //ch
            oldvalue=newvalue;}}
    </script>
</body>
</html>
<!--Copyright &copy; Soumen Chakraborty 2018-->